[
  {
    "function_id": "SF_D4_001",
    "function_name": "score_horizontal_stripes",
    "principle_id": "D4_P01",
    "input_params": ["GarmentProfile (has_horizontal_stripes, has_vertical_stripes, zone, stripe_width_cm, is_dark, covers_waist)", "BodyProfile (body_shape, is_plus_size, is_petite)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Three branches: no stripes (0.0), V-stripes only (base -0.05 with rectangle/INVT overrides), H-stripes (base +0.03 + body-size gate + zone-split + stripe width modifier + dark luminance bonus). Zone-split is critical: pear top +0.08 vs bottom -0.05, INVT top -0.12 vs bottom +0.10.",
    "reversals_handled": ["R8: H-stripe x INVT upper -> -0.12 (attention to shoulders overrides optical thinning)"],
    "exceptions_checked": ["Plus-size Ashida nullification (-0.08)", "Fine stripes <1cm bonus (+0.03)", "Wide stripes >2cm + plus penalty (-0.05)", "Dark luminance bonus (+0.04)"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "168-230"
  },
  {
    "function_id": "SF_D4_002",
    "function_name": "score_dark_slimming",
    "principle_id": "D4_P02",
    "input_params": ["GarmentProfile (color_lightness, is_dark, sheen_index, zone)", "BodyProfile (is_petite, is_tall, body_shape, skin_undertone, skin_darkness)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Three color bands: light (L>0.65: expansion penalty), mid (0.25-0.65: proportional), dark (L<0.25: base +0.15). Dark path has body-type multiplier (petite x0.6, tall x1.2, INVT upper x1.4, hourglass x0.7), skin-tone interaction for face-adjacent garments (warm sallow gradient, dark skin low contrast), and sheen override (SI>0.5 inverts dark benefit, amplified x1.5 for apple/plus).",
    "reversals_handled": ["Dark + shiny inversion (sheen_penalty = -0.15 * ((SI-0.5)/0.5), amplified for apple/plus)"],
    "exceptions_checked": ["Warm undertone sallow gradient (gradual from L=0 to L=0.22)", "Dark skin low contrast (x0.5 at skin_darkness>0.7)", "Specular highlight override on apple/plus"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "260-327"
  },
  {
    "function_id": "SF_D4_003",
    "function_name": "score_rise_elongation",
    "principle_id": "D4_P03",
    "input_params": ["GarmentProfile (rise_cm, waistband_width_cm, waistband_stretch_pct, expansion_rate)", "BodyProfile (is_petite, is_tall, torso_score, body_shape, belly_zone)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Base gradient: +0.015 per cm above 20cm mid-rise. Petite gate with three paths: short torso (INVERTED to -0.30 if rise>26cm), long torso (x1.5), proportional (x1.3). Tall: x0.5. Apple/Plus muffin-top gate: wide elastic (>=5cm, >=8%) gives +0.10, narrow rigid (<3cm, <5%) OVERRIDES to -0.25. Hourglass high rise bonus +0.03. INVT + high rise + slim leg: x0.6.",
    "reversals_handled": ["Petite short torso rise inversion (torso_score <= -1.0 AND rise > 26cm -> -0.30)"],
    "exceptions_checked": ["Muffin-top gate (apple/plus belly_zone > 0.3)", "V-neck + high rise conflict (cross-garment)"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "352-411"
  },
  {
    "function_id": "SF_D4_004",
    "function_name": "score_aline_balance",
    "principle_id": "D4_P04",
    "input_params": ["GarmentProfile (expansion_rate, drape_coefficient, hem_position)", "BodyProfile (body_shape, is_tall, is_petite, is_plus_size)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Trapezoidal ER response: 0.03-0.06 ramp, 0.06-0.12 peak (+0.25), 0.12-0.18 decline, >0.18 further decline. DRAPE GATE: DC<40% full benefit, 40-65% x0.7, >65% INVERTED to x-0.5 (shelf effect). Body-type: INVT +0.15, tall +0.10, petite+ER>0.12 -0.15, pear +0.05. Plus+stiff: shelf amplified x1.5. Pear hem: mid-thigh -0.10, knee +0.05.",
    "reversals_handled": ["Stiff fabric A-line shelf inversion (DC > 65% -> drape_mult = -0.5)", "Plus-size shelf amplification (x1.5)"],
    "exceptions_checked": ["Petite frame overwhelm (ER > 0.12)", "Pear hemline dead zone (mid-thigh)"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "440-515"
  },
  {
    "function_id": "SF_D4_005",
    "function_name": "score_tent_concealment",
    "principle_id": "D4_P05",
    "input_params": ["GarmentProfile (expansion_rate, is_structured)", "BodyProfile (styling_goal, body_shape, is_petite, is_plus_size, is_tall, whr)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Three zones: semi-fitted (ER 0.03-0.08: +0.15 optimal zone), gap (ER 0.08-0.12: 0.0), tent (ER >= 0.12). Dual-goal split for tent: concealment goal -> +0.25/+0.35, slimming goal -> -0.20/-0.40, balance -> weighted 70% slimming. Five body-type reversals: hourglass -0.20, petite -0.15, plus -0.10, INVT -0.10, tall +0.10, rectangle +0.05.",
    "reversals_handled": ["R1: Tent x Hourglass (-0.20 additional: destroys WHR)", "R2: Tent x Petite (-0.15: fabric overwhelms frame)", "R3: Tent x Plus (-0.10: max size overestimate)", "R4: Tent x INVT (-0.10: lampshade)"],
    "exceptions_checked": ["Concealment paradox (dual-goal split)", "Semi-fitted optimal zone", "Plus+structured semi-fitted (+0.20)"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "544-609"
  },
  {
    "function_id": "SF_D4_006",
    "function_name": "score_color_break",
    "principle_id": "D4_P06",
    "input_params": ["GarmentProfile (has_contrasting_belt, has_tonal_belt, belt_width_cm)", "BodyProfile (body_shape, is_petite, is_tall, is_plus_size, whr, belly_zone)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Three paths: no belt (0.0), tonal belt (-0.03), contrasting belt (base -0.10). Hourglass REVERSAL: +0.20 (wide belt +0.25) — exits early. Petite: penalty x1.5. Apple: -0.25 (spotlights widest). Tall: x0.3. INVT: +0.08. Rectangle: +0.05. Pear: WHR-dependent (+0.05 if narrow, -0.10 if moderate). Plus: belly-zone-dependent (-0.20 if belly concern, +0.05 if not).",
    "reversals_handled": ["R7: Color break x Hourglass (standard -0.10 -> actual +0.20, wide belt +0.25)"],
    "exceptions_checked": ["Apple belt spotlighting (-0.25)", "Plus belly zone gate", "Pear WHR-dependent outcome"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "631-696"
  },
  {
    "function_id": "SF_D4_007",
    "function_name": "score_bodycon_mapping",
    "principle_id": "D4_P07",
    "input_params": ["GarmentProfile (expansion_rate, gsm, is_structured, zone)", "BodyProfile (body_shape, is_plus_size, is_athletic, belly_zone)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Gate: ER > 0.03 = not bodycon (0.0). Fabric construction gate: thin (GSM<200, not structured) vs structured (GSM>=250 or is_structured). Hourglass REVERSAL: thin +0.30, structured +0.35, belly concern -0.15 offset. Apple: athletic +0.20, thin -0.40, structured -0.12. Pear: thin -0.30, structured -0.09. Plus: thin -0.40, structured -0.05. INVT: zone-dependent (-0.15 full, -0.10 top, -0.05 bottom). Rectangle: 0.0.",
    "reversals_handled": ["R6: Bodycon x Hourglass (standard -0.10 -> actual +0.30/+0.35)", "R5: Bodycon x Apple amplified (-0.10 -> -0.40)"],
    "exceptions_checked": ["Fabric construction gate (0.35-point spread)", "Athletic apple exception (+0.20)", "Hourglass belly concern offset (-0.15)", "INVT zone dependency"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "723-809"
  },
  {
    "function_id": "SF_D4_008",
    "function_name": "score_matte_zone",
    "principle_id": "D4_P08",
    "input_params": ["GarmentProfile (sheen_index, zone, cling_risk)", "BodyProfile (body_shape, is_plus_size)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Four sheen bands: deeply matte (SI<0.15: +0.08), low sheen (0.15-0.35: proportional decline), neutral (0.35-0.50: 0.0), high sheen (>0.50: negative). Body-type multiplier: apple x1.5, plus x1.5, pear hip x1.3, hourglass x0.5 (moderate sheen positive), INVT upper x1.2. CLING TRAP: matte + cling>0.6 OVERRIDES to negative (plus -0.15, apple -0.12, pear -0.10).",
    "reversals_handled": ["Hourglass moderate sheen benefit (SI 0.35-0.55 -> +0.05)"],
    "exceptions_checked": ["Cling trap override (matte + clingy on plus/apple/pear)", "Hourglass sheen curve enhancement"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "831-887"
  },
  {
    "function_id": "SF_D4_009",
    "function_name": "score_vneck_elongation",
    "principle_id": "D4_P09",
    "input_params": ["GarmentProfile (neckline, rise_cm)", "BodyProfile (body_shape, is_petite, is_tall, torso_score)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Non-V paths: crew (0.0), boat/off-shoulder (INVT -0.15, rectangle +0.08, pear +0.05), scoop (+0.05, INVT +0.08), turtleneck (INVT -0.05, petite short-torso +0.10). V-neck path: base +0.10. INVT +0.18 (max). Hourglass +0.12. Petite short-torso + high rise: CONFLICT -0.05. Petite short-torso + mid/low rise: +0.15. Petite normal: +0.12. Apple: +0.10. Tall: +0.05. Pear: +0.10.",
    "reversals_handled": ["V-neck + high rise on petite short-torso: conflicting attention directions (-0.05)"],
    "exceptions_checked": ["Boat neck on INVT (-0.15, widens shoulders)", "Turtleneck on petite short-torso with high rise (+0.10)", "Cross-garment V-neck + rise conflict"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "914-987"
  },
  {
    "function_id": "SF_D4_010",
    "function_name": "score_monochrome_column",
    "principle_id": "D4_P10",
    "input_params": ["GarmentProfile (is_monochrome_outfit, is_dark, color_lightness, has_contrasting_belt, has_tonal_belt)", "BodyProfile (is_petite, is_tall, body_shape, is_plus_size)"],
    "output": "Tuple[float, str] — (score in [-1,+1], reasoning chain)",
    "key_logic_summary": "Gate: not monochrome = 0.0. Base +0.08. Dark bonus +0.07. Petite: +0.15 (AMPLIFIED). Tall: +0.03. Hourglass: +0.03 (flattens waist-hip), +belt -> +0.12 (best of both). INVT: +0.05 (misses dark-top-light-bottom). Apple: +0.08, dark +0.15. Pear: +0.05, dark +0.12. Plus: +0.10, plus-dark +0.18 (most reliable combo).",
    "reversals_handled": [],
    "exceptions_checked": ["Hourglass + monochrome + belt (best of both worlds +0.12)", "INVT dark-top-light-bottom superior to monochrome (+0.15 vs +0.05)", "Plus-size dark monochrome as most reliable recommendation"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "1008-1060"
  },
  {
    "function_id": "SF_D4_011",
    "function_name": "score_garment_composite",
    "principle_id": "COMPOSITE",
    "input_params": ["GarmentProfile", "BodyProfile"],
    "output": "Tuple[float, List[PrincipleResult]] — (composite score in [-1,+1], list of 10 principle results with name, score, reasoning, weight, applicable flag)",
    "key_logic_summary": "Calls all 10 scorers. Assigns weights: non-applicable -> 0, goal-matching -> x1.5, strong negatives (<-0.15) -> x1.2. Computes weighted average of applicable principles. SILHOUETTE DOMINANCE RULE: if tent/bodycon < -0.20 AND goal = slimming, composite forced to worst_silhouette * 0.3 (cannot go positive). Clamps to [-1, +1].",
    "reversals_handled": ["Silhouette dominance prevents color/pattern from masking wrong fit"],
    "exceptions_checked": ["Non-applicable principle detection (score ~0 + 'N/A')", "Goal-based weight amplification (SLIMMING, EMPHASIS, CONCEALMENT)"],
    "source_domain": 4,
    "source_file": "kridha_scoring_engine_v4.py",
    "lines_of_code": "1076-1155"
  }
]
